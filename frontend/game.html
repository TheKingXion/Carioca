<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego - Carioca Online</title>
    <link rel="stylesheet" href="css/game.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
</head>
<body>
    <div class="game-container">
        <!-- Header del Juego -->
        <header class="game-header">
            <div class="header-left">
                <div class="game-info">
                    <h1 class="game-title">🃏 Carioca Online</h1>
                    <div class="sala-info">
                        <span class="sala-codigo" id="salaCodigoDisplay">Sala: ------</span>
                        <span class="contrato-actual" id="contratoActual">Contrato 1: 2 Tríos</span>
                    </div>
                </div>
            </div>
            
            <div class="header-center">
                <div class="turno-info">
                    <div class="turno-jugador" id="turnoJugador">Tu turno</div>
                    <div class="tiempo-restante">
                        <div class="timer-circle">
                            <span id="tiempoRestante">30</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <button class="game-btn" onclick="mostrarAyuda()">
                    ❓ Ayuda
                </button>
                <button class="game-btn" onclick="mostrarConfiguracion()">
                    ⚙️ Config
                </button>
                <button class="game-btn danger" onclick="abandonarPartida()">
                    🚪 Salir
                </button>
            </div>
        </header>

        <!-- Mesa de Juego -->
        <main class="game-board">
            <!-- Jugadores Oponentes -->
            <div class="opponents-area">
                <div class="opponent-slot" id="opponent1" style="display: none;">
                    <div class="player-info">
                        <div class="player-avatar">👤</div>
                        <div class="player-details">
                            <span class="player-name">Jugador 1</span>
                            <span class="player-cards">7 cartas</span>
                        </div>
                    </div>
                    <div class="player-combinations" id="combinations1"></div>
                </div>
                
                <div class="opponent-slot" id="opponent2" style="display: none;">
                    <div class="player-info">
                        <div class="player-avatar">👤</div>
                        <div class="player-details">
                            <span class="player-name">Jugador 2</span>
                            <span class="player-cards">7 cartas</span>
                        </div>
                    </div>
                    <div class="player-combinations" id="combinations2"></div>
                </div>
                
                <div class="opponent-slot" id="opponent3" style="display: none;">
                    <div class="player-info">
                        <div class="player-avatar">👤</div>
                        <div class="player-details">
                            <span class="player-name">Jugador 3</span>
                            <span class="player-cards">7 cartas</span>
                        </div>
                    </div>
                    <div class="player-combinations" id="combinations3"></div>
                </div>
            </div>

            <!-- Área Central de Juego -->
            <div class="center-area">
                <!-- Mazo y Descarte -->
                <div class="deck-area">
                    <div class="deck-pile" onclick="robarDelMazo()">
                        <div class="card-back">
                            <div class="card-pattern"></div>
                        </div>
                        <span class="pile-label">Mazo</span>
                        <span class="cards-count" id="mazoCount">40</span>
                    </div>
                    
                    <div class="discard-pile" onclick="robarDelDescarte()">
                        <div class="card" id="cartaDescarte">
                            <div class="card-content">
                                <span class="card-value">A</span>
                                <span class="card-suit">♠</span>
                            </div>
                        </div>
                        <span class="pile-label">Descarte</span>
                    </div>
                </div>

                <!-- Área de Combinaciones del Jugador -->
                <div class="player-combinations-area" id="playerCombinations">
                    <div class="combinations-header">
                        <h3>🎯 Tus Combinaciones</h3>
                        <button class="validate-btn" onclick="validarCombinaciones()" style="display: none;">
                            ✅ Validar
                        </button>
                    </div>
                    <div class="combinations-container" id="combinationsContainer">
                        <div class="empty-combinations">
                            <p>Arrastra aquí tus tríos y escalas</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Área del Jugador Actual -->
            <div class="player-area">
                <div class="player-hand-container">
                    <div class="hand-header">
                        <h3>🃏 Tus Cartas</h3>
                        <div class="hand-controls">
                            <button class="hand-btn" onclick="ordenarCartas()">
                                🔄 Ordenar
                            </button>
                            <button class="hand-btn" onclick="mostrarAyudaCartas()">
                                💡 Ayuda
                            </button>
                        </div>
                    </div>
                    
                    <div class="player-hand" id="playerHand">
                        <!-- Las cartas se cargan dinámicamente -->
                    </div>
                </div>

                <!-- Acciones del Jugador -->
                <div class="player-actions">
                    <button class="action-btn primary" id="robarBtn" onclick="mostrarOpcionesRobar()" disabled>
                        🎴 Robar Carta
                    </button>
                    <button class="action-btn secondary" id="bajarBtn" onclick="intentarBajarCombinaciones()" disabled>
                        ⬇️ Bajar Combinaciones
                    </button>
                    <button class="action-btn tertiary" id="descartarBtn" onclick="activarModoDescarte()" disabled>
                        🗑️ Descartar
                    </button>
                    <button class="action-btn special" id="cariocaBtn" onclick="declararCarioca()" disabled>
                        🏆 ¡CARIOCA!
                    </button>
                </div>
            </div>
        </main>

        <!-- Panel Lateral de Información -->
        <aside class="info-panel">
            <div class="panel-section">
                <h3>📊 Puntuación</h3>
                <div class="scores-table" id="scoresTable">
                    <!-- Se llena dinámicamente -->
                </div>
            </div>

            <div class="panel-section">
                <h3>📋 Contrato Actual</h3>
                <div class="contract-info" id="contractInfo">
                    <div class="contract-number">1</div>
                    <div class="contract-description">
                        <strong>2 Tríos</strong>
                        <p>Formar 2 tríos (3 cartas del mismo número cada uno)</p>
                    </div>
                    <div class="contract-progress">
                        <div class="progress-item">
                            <span>Tríos: 0/2</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <h3>💬 Chat</h3>
                <div class="game-chat">
                    <div class="chat-messages" id="gameChatMessages">
                        <div class="system-message">
                            <span class="timestamp">12:00</span>
                            <span class="message">¡La partida ha comenzado! 🎉</span>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="gameChatInput" placeholder="Mensaje..." maxlength="100">
                        <button class="send-btn" onclick="enviarMensajeJuego()">📤</button>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Modal de Opciones de Robar -->
    <div id="robarModal" class="modal" style="display: none;">
        <div class="modal-content robar-modal">
            <div class="modal-header">
                <h3>🎴 ¿De dónde quieres robar?</h3>
                <button class="modal-close" onclick="cerrarModal('robarModal')">×</button>
            </div>
            <div class="modal-body">
                <div class="robar-options">
                    <button class="robar-option" onclick="robarCarta('mazo')">
                        <div class="option-icon">🎴</div>
                        <div class="option-info">
                            <strong>Del Mazo</strong>
                            <p>Carta aleatoria</p>
                        </div>
                    </button>
                    <button class="robar-option" onclick="robarCarta('descarte')" id="robarDescarteBtn">
                        <div class="option-icon">♠️</div>
                        <div class="option-info">
                            <strong>Del Descarte</strong>
                            <p id="cartaDescarteInfo">As de Picas</p>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda -->
    <div id="ayudaModal" class="modal" style="display: none;">
        <div class="modal-content ayuda-modal">
            <div class="modal-header">
                <h3>❓ Ayuda - Cómo Jugar Carioca</h3>
                <button class="modal-close" onclick="cerrarModal('ayudaModal')">×</button>
            </div>
            <div class="modal-body">
                <div class="ayuda-tabs">
                    <button class="tab-btn active" onclick="mostrarTab('reglas')">📖 Reglas</button>
                    <button class="tab-btn" onclick="mostrarTab('contratos')">🎯 Contratos</button>
                    <button class="tab-btn" onclick="mostrarTab('puntuacion')">📊 Puntuación</button>
                </div>
                
                <div class="tab-content" id="reglasTab">
                    <h4>🎮 Objetivo del Juego</h4>
                    <p>Ser el primero en completar los 10 contratos y quedarse sin cartas.</p>
                    
                    <h4>🔄 Cómo Jugar</h4>
                    <ol>
                        <li><strong>Robar:</strong> Toma una carta del mazo o descarte</li>
                        <li><strong>Bajar:</strong> Forma las combinaciones requeridas</li>
                        <li><strong>Descartar:</strong> Descarta una carta para terminar tu turno</li>
                    </ol>
                    
                    <h4>🎯 Combinaciones</h4>
                    <ul>
                        <li><strong>Trío:</strong> 3 cartas del mismo número</li>
                        <li><strong>Escala:</strong> 4+ cartas consecutivas del mismo palo</li>
                        <li><strong>Comodín:</strong> Los Jokers pueden reemplazar cualquier carta</li>
                    </ul>
                </div>
                
                <div class="tab-content" id="contratosTab" style="display: none;">
                    <div class="contratos-list">
                        <div class="contrato-item">
                            <span class="contrato-num">1</span>
                            <span class="contrato-desc">2 Tríos</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">2</span>
                            <span class="contrato-desc">1 Escala + 1 Trío</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">3</span>
                            <span class="contrato-desc">2 Escalas</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">4</span>
                            <span class="contrato-desc">3 Tríos</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">5</span>
                            <span class="contrato-desc">2 Tríos + 1 Escala</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">6</span>
                            <span class="contrato-desc">2 Escalas + 1 Trío</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">7</span>
                            <span class="contrato-desc">3 Escalas</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">8</span>
                            <span class="contrato-desc">4 Tríos</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">9</span>
                            <span class="contrato-desc">Escala Falsa (A-K)</span>
                        </div>
                        <div class="contrato-item">
                            <span class="contrato-num">10</span>
                            <span class="contrato-desc">Escala Real (A-K mismo palo)</span>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="puntuacionTab" style="display: none;">
                    <h4>💰 Valores de las Cartas</h4>
                    <ul>
                        <li><strong>As:</strong> 15 puntos</li>
                        <li><strong>Figuras (J, Q, K):</strong> 10 puntos</li>
                        <li><strong>Números (2-10):</strong> Valor nominal</li>
                        <li><strong>Jokers:</strong> 25 puntos</li>
                    </ul>
                    
                    <h4>🏆 Cómo Ganar</h4>
                    <p>El jugador con menos puntos al final de los 10 contratos gana.</p>
                    <p><strong>¡CARIOCA!</strong> Si te quedas sin cartas, no sumas puntos esa ronda.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación de Salida -->
    <div id="salirModal" class="modal" style="display: none;">
        <div class="modal-content confirm-modal">
            <div class="modal-header">
                <h3>⚠️ Confirmar Salida</h3>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que quieres abandonar la partida?</p>
                <p><strong>Perderás automáticamente y se sumará una derrota.</strong></p>
                <div class="confirm-actions">
                    <button class="confirm-btn cancel" onclick="cerrarModal('salirModal')">
                        ❌ Cancelar
                    </button>
                    <button class="confirm-btn confirm" onclick="confirmarSalida()">
                        ✅ Sí, salir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/card-manager.js"></script>
    <script src="js/game.js"></script>
</body>
</html>
